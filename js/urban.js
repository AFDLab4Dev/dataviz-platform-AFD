var data = {
    "country": [{
        "name": "Afrique du Sud",
        "iso3": "ZAF",
        "city": [{
            "name": "Cape Town",
            "gps": [-33.92584, 18.42322]
        }, {
            "name": "Pretoria",
            "gps": [-25.74486, 28.18783]
        }, {
            "name": "Johannesburg",
            "gps": [-26.20227, 28.04363]
        }, {
            "name": "Durban",
            "gps": [-29.8579, 31.0292]
        }, {
            "name": "Soweto",
            "gps": [-26.26781, 27.85849]
        }, {
            "name": "Pietermaritzburg",
            "gps": [-29.61679, 30.39278]
        }, {
            "name": "Port Elizabeth",
            "gps": [-33.91799, 25.57007]
        }, {
            "name": "Benoni",
            "gps": [-26.18848, 28.32078]
        }, {
            "name": "East London",
            "gps": [-33.01529, 27.91162]
        }, {
            "name": "Nelspruit",
            "gps": [-25.47448, 30.97033]
        }]
    }, {
        "name": "Algérie",
        "iso3": "DZA",
        "city": [{
            "name": "Algiers",
            "gps": [36.7525, 3.04197]
        }, {
            "name": "Oran",
            "gps": [35.69111, -0.64167]
        }, {
            "name": "Tébessa",
            "gps": [35.40417, 8.12417]
        }, {
            "name": "Boumerdas",
            "gps": [36.76639, 3.47717]
        }, {
            "name": "Biskra",
            "gps": [34.85038, 5.72805]
        }, {
            "name": "Sétif",
            "gps": [36.19112, 5.41373]
        }, {
            "name": "Constantine",
            "gps": [36.365, 6.61472]
        }, {
            "name": "Batna City",
            "gps": [35.55597, 6.17414]
        }, {
            "name": "Annaba",
            "gps": [36.9, 7.76667]
        }, {
            "name": "Bab Ezzouar",
            "gps": [36.72615, 3.18291]
        }]
    }, {
        "name": "Angola",
        "iso3": "AGO",
        "city": [{
            "name": "Luanda",
            "gps": [-8.83682, 13.23432]
        }, {
            "name": "Huambo",
            "gps": [-12.77611, 15.73917]
        }, {
            "name": "N'dalatando",
            "gps": [-9.29782, 14.91162]
        }, {
            "name": "Benguela",
            "gps": [-12.57626, 13.40547]
        }, {
            "name": "Lobito",
            "gps": [-12.3644, 13.53601]
        }, {
            "name": "Lubango",
            "gps": [-14.91717, 13.4925]
        }, {
            "name": "Kuito",
            "gps": [-12.38333, 16.93333]
        }, {
            "name": "Namibe",
            "gps": [-15.19611, 12.15222]
        }, {
            "name": "Malanje",
            "gps": [-9.54015, 16.34096]
        }, {
            "name": "Soyo",
            "gps": [-6.1349, 12.36894]
        }]
    }, {
        "name": "Bénin",
        "iso3": "BEN",
        "city": [{
            "name": "Porto-Novo",
            "gps": [6.49646, 2.60359]
        }, {
            "name": "Cotonou",
            "gps": [6.36536, 2.41833]
        }, {
            "name": "Parakou",
            "gps": [9.33716, 2.63031]
        }, {
            "name": "Djougou",
            "gps": [9.70853, 1.66598]
        }, {
            "name": "Abomey-Calavi",
            "gps": [6.44852, 2.35566]
        }, {
            "name": "Kandi",
            "gps": [11.13417, 2.93861]
        }, {
            "name": "Ouidah",
            "gps": [6.36307, 2.08506]
        }, {
            "name": "Bohicon",
            "gps": [7.17826, 2.0667]
        }, {
            "name": "Lokossa",
            "gps": [6.63869, 1.71674]
        }, {
            "name": "Abomey",
            "gps": [7.18286, 1.99119]
        }]
    }, {
        "name": "Botswana",
        "iso3": "BWA",
        "city": [{
            "name": "Gaborone",
            "gps": [-24.65451, 25.90859]
        }, {
            "name": "Francistown",
            "gps": [-21.16995, 27.50787]
        }, {
            "name": "Molepolole",
            "gps": [-24.40659, 25.49508]
        }, {
            "name": "Selebi-Phikwe",
            "gps": [-21.97895, 27.84296]
        }, {
            "name": "Serowe",
            "gps": [-22.38754, 26.71077]
        }, {
            "name": "Maun",
            "gps": [-19.98333, 23.41667]
        }, {
            "name": "Kanye",
            "gps": [-24.96675, 25.33273]
        }, {
            "name": "Mochudi",
            "gps": [-24.41667, 26.15]
        }, {
            "name": "Mahalapye",
            "gps": [-23.10407, 26.81421]
        }, {
            "name": "Mogoditshane",
            "gps": [-24.62694, 25.86556]
        }]
    }, {
        "name": "Burkina Faso",
        "iso3": "BFA",
        "city": [{
            "name": "Ouagadougou",
            "gps": [12.36566, -1.53388]
        }, {
            "name": "Bobo-Dioulasso",
            "gps": [11.17715, -4.2979]
        }, {
            "name": "Koudougou",
            "gps": [12.25263, -2.36272]
        }, {
            "name": "Ouahigouya",
            "gps": [13.58278, -2.42158]
        }, {
            "name": "Banfora",
            "gps": [10.63333, -4.76667]
        }, {
            "name": "Dédougou",
            "gps": [12.46338, -3.46075]
        }, {
            "name": "Kaya",
            "gps": [13.09167, -1.08444]
        }, {
            "name": "Dori",
            "gps": [14.0354, -0.0345]
        }, {
            "name": "Tenkodogo",
            "gps": [11.78, -0.36972]
        }, {
            "name": "Réo",
            "gps": [12.31963, -2.47094]
        }]
    }, {
        "name": "Burundi",
        "iso3": "BDI",
        "city": [{
            "name": "Bujumbura",
            "gps": [-3.3822, 29.3644]
        }, {
            "name": "Muyinga",
            "gps": [-2.8451, 30.3414]
        }, {
            "name": "Ruyigi",
            "gps": [-3.47639, 30.24861]
        }, {
            "name": "Gitega",
            "gps": [-3.4264, 29.9308]
        }, {
            "name": "Ngozi",
            "gps": [-2.9075, 29.8306]
        }, {
            "name": "Bururi",
            "gps": [-3.94877, 29.62438]
        }, {
            "name": "Rutana",
            "gps": [-3.9279, 29.992]
        }, {
            "name": "Makamba",
            "gps": [-4.1348, 29.804]
        }, {
            "name": "Kayanza",
            "gps": [-2.9221, 29.6293]
        }, {
            "name": "Muramvya",
            "gps": [-3.2682, 29.6079]
        }]
    }, {
        "name": "Cameroun",
        "iso3": "CMR",
        "city": [{
            "name": "Yaoundé",
            "gps": [3.86667, 11.51667]
        }, {
            "name": "Douala",
            "gps": [4.04827, 9.70428]
        }, {
            "name": "Garoua",
            "gps": [9.30143, 13.39771]
        }, {
            "name": "Bamenda",
            "gps": [5.9597, 10.14597]
        }, {
            "name": "Bafoussam",
            "gps": [5.47775, 10.41759]
        }, {
            "name": "Maroua",
            "gps": [10.59095, 14.31593]
        }, {
            "name": "Kousséri",
            "gps": [12.07689, 15.03063]
        }, {
            "name": "Ngaoundéré",
            "gps": [7.32765, 13.58472]
        }, {
            "name": "Bertoua",
            "gps": [4.57728, 13.68459]
        }, {
            "name": "Mokolo",
            "gps": [10.74244, 13.80227]
        }]
    }, {
        "name": "République centrafricaine",
        "iso3": "CAF",
        "city": [{
            "name": "Bangui",
            "gps": [4.36122, 18.55496]
        }, {
            "name": "Bimbo",
            "gps": [4.25671, 18.41583]
        }, {
            "name": "Mbaïki",
            "gps": [3.86781, 17.98923]
        }, {
            "name": "Berbérati",
            "gps": [4.26116, 15.79216]
        }, {
            "name": "Kaga-Bandoro",
            "gps": [6.98961, 19.18744]
        }, {
            "name": "Bozoum",
            "gps": [6.31933, 16.37992]
        }, {
            "name": "Sibut",
            "gps": [5.71801, 19.07389]
        }, {
            "name": "Bambari",
            "gps": [5.76795, 20.67565]
        }, {
            "name": "Carnot",
            "gps": [4.94273, 15.87735]
        }, {
            "name": "Bria",
            "gps": [6.54233, 21.98633]
        }]
    }, {
        "name": " République du Congo",
        "iso3": "COG",
        "city": [{
            "name": "Brazzaville",
            "gps": [-4.26613, 15.28318]
        }, {
            "name": "Pointe-Noire",
            "gps": [-4.77609, 11.86352]
        }, {
            "name": "Dolisie",
            "gps": [-4.19834, 12.66664]
        }, {
            "name": "Kayes",
            "gps": [-4.20493, 13.28608]
        }, {
            "name": "Owando",
            "gps": [-0.48193, 15.89988]
        }, {
            "name": "Ouésso",
            "gps": [1.61361, 16.05167]
        }, {
            "name": "Impfondo",
            "gps": [1.61804, 18.05981]
        }, {
            "name": "Madingou",
            "gps": [-4.15361, 13.55]
        }, {
            "name": "Loandjili",
            "gps": [-4.75611, 11.85778]
        }, {
            "name": "Gamboma",
            "gps": [-1.87639, 15.86444]
        }]
    }, {
        "name": "République Démocratique du Congo",
        "iso3": "COD",
        "city": [{
            "name": "Kinshasa",
            "gps": [-4.32758, 15.31357]
        }, {
            "name": "Lubumbashi",
            "gps": [-11.66089, 27.47938]
        }, {
            "name": "Kisangani",
            "gps": [0.51528, 25.19099]
        }, {
            "name": "Mbuji-Mayi",
            "gps": [-6.13603, 23.58979]
        }, {
            "name": "Kananga",
            "gps": [-5.89624, 22.41659]
        }, {
            "name": "Masina",
            "gps": [-4.38361, 15.39139]
        }, {
            "name": "Likasi",
            "gps": [-10.98303, 26.7384]
        }, {
            "name": "Bukavu",
            "gps": [-2.49077, 28.84281]
        }, {
            "name": "Kolwezi",
            "gps": [-10.71484, 25.46674]
        }, {
            "name": "Tshikapa",
            "gps": [-6.41621, 20.79995]
        }]
    }, {
        "name": "Côte d'Ivoire",
        "iso3": "CIV",
        "city": [{
            "name": "Abidjan",
            "gps": [5.30966, -4.01266]
        }, {
            "name": "Yamoussoukro",
            "gps": [6.82055, -5.27674]
        }, {
            "name": "Bouaké",
            "gps": [7.69385, -5.03031]
        }, {
            "name": "San-Pédro",
            "gps": [4.74851, -6.6363]
        }, {
            "name": "Daloa",
            "gps": [6.87735, -6.45022]
        }, {
            "name": "Abobo",
            "gps": [5.41613, -4.0159]
        }, {
            "name": "Man",
            "gps": [7.41251, -7.55383]
        }, {
            "name": "Korhogo",
            "gps": [9.45803, -5.62961]
        }, {
            "name": "Gagnoa",
            "gps": [6.13193, -5.9506]
        }, {
            "name": "Divo",
            "gps": [5.83739, -5.35723]
        }]
    }, {
        "name": "Djibouti",
        "iso3": "DJI",
        "city": [{
            "name": "Djibouti",
            "gps": [11.58901, 43.14503]
        }, {
            "name": "Ali Sabih",
            "gps": [11.15583, 42.7125]
        }, {
            "name": "Tadjoura",
            "gps": [11.78528, 42.88444]
        }, {
            "name": "Obock",
            "gps": [11.96306, 43.29056]
        }, {
            "name": "Ḏânan",
            "gps": [11.18333, 42.93333]
        }]
    }, {
        "name": "Egypte",
        "iso3": "EGY",
        "city": [{
            "name": "Cairo",
            "gps": [30.06263, 31.24967]
        }, {
            "name": "Alexandria",
            "gps": [31.21564, 29.95527]
        }, {
            "name": "Giza",
            "gps": [30.00808, 31.21093]
        }, {
            "name": "Port Said",
            "gps": [31.25654, 32.28411]
        }, {
            "name": "Suez",
            "gps": [29.97371, 32.52627]
        }, {
            "name": "Luxor",
            "gps": [25.69893, 32.6421]
        }, {
            "name": "Tanta",
            "gps": [30.78847, 31.00192]
        }, {
            "name": "Assiut",
            "gps": [27.18096, 31.18368]
        }, {
            "name": "Al Mansurah",
            "gps": [31.03637, 31.38069]
        }, {
            "name": "Al Maḩallah al Kubrá",
            "gps": [30.97063, 31.1669]
        }]
    }, {
        "name": "Erythrée",
        "iso3": "ERI",
        "city": [{
            "name": "Asmara",
            "gps": [15.33805, 38.93184]
        }, {
            "name": "Keren",
            "gps": [15.77792, 38.45107]
        }, {
            "name": "Massawa",
            "gps": [15.60811, 39.47455]
        }, {
            "name": "Assab",
            "gps": [13.00917, 42.73944]
        }, {
            "name": "Mendefera",
            "gps": [14.88722, 38.81528]
        }, {
            "name": "Barentu",
            "gps": [15.10582, 37.59067]
        }]
    }, {
        "name": "Ethiopie",
        "iso3": "ETH",
        "city": [{
            "name": "Addis Ababa",
            "gps": [9.02497, 38.74689]
        }, {
            "name": "Mek'ele",
            "gps": [13.49667, 39.47528]
        }, {
            "name": "Dire Dawa",
            "gps": [9.59306, 41.86611]
        }, {
            "name": "Bahir Dar",
            "gps": [11.59364, 37.39077]
        }, {
            "name": "Gonder",
            "gps": [12.6, 37.46667]
        }, {
            "name": "Dessie",
            "gps": [11.13333, 39.63333]
        }, {
            "name": "Awasa",
            "gps": [7.06205, 38.47635]
        }, {
            "name": "Nazrēt",
            "gps": [8.55, 39.26667]
        }, {
            "name": "Jimma",
            "gps": [7.67344, 36.83441]
        }, {
            "name": "Harar",
            "gps": [9.31387, 42.11815]
        }]
    }, {
        "name": "Gabon",
        "iso3": "GAB",
        "city": [{
            "name": "Libreville",
            "gps": [0.39241, 9.45356]
        }, {
            "name": "Port-Gentil",
            "gps": [-0.71933, 8.78151]
        }, {
            "name": "Franceville",
            "gps": [-1.63333, 13.58357]
        }, {
            "name": "Oyem",
            "gps": [1.5995, 11.57933]
        }, {
            "name": "Moanda",
            "gps": [-1.56652, 13.1987]
        }, {
            "name": "Lambaréné",
            "gps": [-0.7001, 10.24055]
        }, {
            "name": "Mouila",
            "gps": [-1.86846, 11.05594]
        }, {
            "name": "Koulamoutou",
            "gps": [-1.13667, 12.46399]
        }, {
            "name": "Tchibanga",
            "gps": [-2.93323, 10.98178]
        }]
    }, {
        "name": "Gambie",
        "iso3": "GMB",
        "city": [{
            "name": "Banjul",
            "gps": [13.45274, -16.57803]
        }, {
            "name": "Brikama",
            "gps": [13.27136, -16.64944]
        }, {
            "name": "Bakau",
            "gps": [13.47806, -16.68194]
        }, {
            "name": "Farafenni",
            "gps": [13.56667, -15.6]
        }, {
            "name": "Sukuta",
            "gps": [13.41033, -16.70815]
        }, {
            "name": "Lamin",
            "gps": [13.35222, -16.43389]
        }]
    }, {
        "name": "Ghana",
        "iso3": "GHA",
        "city": [{
            "name": "Accra",
            "gps": [5.55602, -0.1969]
        }, {
            "name": "Kumasi",
            "gps": [6.68848, -1.62443]
        }, {
            "name": "Tamale",
            "gps": [9.40079, -0.8393]
        }, {
            "name": "Cape Coast",
            "gps": [5.10535, -1.2466]
        }, {
            "name": "Tema",
            "gps": [5.6698, -0.01657]
        }, {
            "name": "Takoradi",
            "gps": [4.88447, -1.75536]
        }, {
            "name": "Sekondi-Takoradi",
            "gps": [4.934, -1.7137]
        }, {
            "name": "Achiaman",
            "gps": [5.7, -0.33333]
        }, {
            "name": "Teshie",
            "gps": [5.58365, -0.10722]
        }, {
            "name": "Obuasi",
            "gps": [6.20602, -1.66191]
        }]
    }, {
        "name": "Guinée",
        "iso3": "GIN",
        "city": [{
            "name": "Conakry",
            "gps": [9.53795, -13.67729]
        }, {
            "name": "Nzérékoré",
            "gps": [7.75624, -8.8179]
        }, {
            "name": "Kindia",
            "gps": [10.05692, -12.86576]
        }, {
            "name": "Kankan",
            "gps": [10.38542, -9.30568]
        }, {
            "name": "Camayenne",
            "gps": [9.535, -13.68778]
        }, {
            "name": "Port Kamsar",
            "gps": [10.66667, -14.6]
        }, {
            "name": "Gueckedou",
            "gps": [8.56744, -10.1336]
        }, {
            "name": "Coyah",
            "gps": [9.70643, -13.38465]
        }, {
            "name": "Labé",
            "gps": [11.31823, -12.28332]
        }, {
            "name": "Kissidougou",
            "gps": [9.1848, -10.09987]
        }]
    }, {
        "name": "Guinée-Bissau",
        "iso3": "GNB",
        "city": [{
            "name": "Bissau",
            "gps": [11.86357, -15.59767]
        }, {
            "name": "Bafatá",
            "gps": [12.16583, -14.66167]
        }]
    }, {
        "name": "Guinée-quatoriale",
        "iso3": "GNQ",
        "city": [{
            "name": "Malabo",
            "gps": [3.75, 8.78333]
        }, {
            "name": "Bata",
            "gps": [1.86391, 9.76582]
        }, {
            "name": "Ebebiyin",
            "gps": [2.15106, 11.33528]
        }]
    }, {
        "name": "Kenya",
        "iso3": "KEN",
        "city": [{
            "name": "Nairobi",
            "gps": [-1.28333, 36.81667]
        }, {
            "name": "Mombasa",
            "gps": [-4.05466, 39.66359]
        }, {
            "name": "Nakuru",
            "gps": [-0.28333, 36.06667]
        }, {
            "name": "Eldoret",
            "gps": [0.52036, 35.26993]
        }, {
            "name": "Kisumu",
            "gps": [-0.10221, 34.76171]
        }, {
            "name": "Thika",
            "gps": [-1.03326, 37.06933]
        }, {
            "name": "Malindi",
            "gps": [-3.21799, 40.11692]
        }, {
            "name": "Kitale",
            "gps": [1.01572, 35.00622]
        }, {
            "name": "Garissa",
            "gps": [-0.45275, 39.64601]
        }, {
            "name": "Kakamega",
            "gps": [0.28422, 34.75229]
        }]
    }, {
        "name": "Lesotho",
        "iso3": "LSO",
        "city": [{
            "name": "Maseru",
            "gps": [-29.31667, 27.48333]
        }, {
            "name": "Mafeteng",
            "gps": [-29.82299, 27.23744]
        }, {
            "name": "Hlotse",
            "gps": [-28.87185, 28.04501]
        }, {
            "name": "Qacha's Nek",
            "gps": [-30.11537, 28.68936]
        }, {
            "name": "Mohale's Hoek",
            "gps": [-30.15137, 27.47691]
        }, {
            "name": "Maputsoe",
            "gps": [-28.8866, 27.89915]
        }, {
            "name": "Quthing",
            "gps": [-30.40001, 27.70027]
        }, {
            "name": "Butha-Buthe",
            "gps": [-28.76659, 28.24937]
        }]
    }, {
        "name": "Liberia",
        "iso3": "LBR",
        "city": [{
            "name": "Monrovia",
            "gps": [6.30054, -10.7969]
        }, {
            "name": "Gbarnga",
            "gps": [6.99543, -9.47122]
        }, {
            "name": "Kakata",
            "gps": [6.53104, -10.35368]
        }, {
            "name": "Harper",
            "gps": [4.3782, -7.71081]
        }, {
            "name": "Buchanan",
            "gps": [5.88109, -10.04472]
        }, {
            "name": "Bensonville",
            "gps": [6.44716, -10.61283]
        }, {
            "name": "Voinjama",
            "gps": [8.42194, -9.74778]
        }, {
            "name": "Zwedru",
            "gps": [6.06846, -8.13559]
        }, {
            "name": "Greenville",
            "gps": [5.01133, -9.0388]
        }, {
            "name": "New Yekepa",
            "gps": [7.57944, -8.53778]
        }]
    }, {
        "name": "Libye",
        "iso3": "LBY",
        "city": [{
            "name": "Tripoli",
            "gps": [32.87519, 13.18746]
        }, {
            "name": "Benghazi",
            "gps": [32.11486, 20.06859]
        }, {
            "name": "Misratah",
            "gps": [32.37535, 15.09254]
        }, {
            "name": "Al Khums",
            "gps": [32.64861, 14.26191]
        }, {
            "name": "Ajdabiya",
            "gps": [30.75545, 20.22625]
        }, {
            "name": "Tarhuna",
            "gps": [32.43501, 13.6332]
        }, {
            "name": "Az Zāwīyah",
            "gps": [32.7571, 12.72764]
        }, {
            "name": "Sirte",
            "gps": [31.20892, 16.58866]
        }, {
            "name": "Sabha",
            "gps": [27.03766, 14.42832]
        }, {
            "name": "Zawiya",
            "gps": [32.75222, 12.72778]
        }]
    }, {
        "name": "Madagascar",
        "iso3": "MDG",
        "city": [{
            "name": "Antananarivo",
            "gps": [-18.91368, 47.53613]
        }, {
            "name": "Antsirabe",
            "gps": [-19.86586, 47.03333]
        }, {
            "name": "Toamasina",
            "gps": [-18.1492, 49.40234]
        }, {
            "name": "Mahajanga",
            "gps": [-15.71667, 46.31667]
        }, {
            "name": "Fianarantsoa",
            "gps": [-21.45267, 47.08569]
        }, {
            "name": "Toliara",
            "gps": [-23.35, 43.66667]
        }, {
            "name": "Antsiranana",
            "gps": [-12.31732, 49.29188]
        }, {
            "name": "Ambovombe",
            "gps": [-25.17838, 46.08722]
        }, {
            "name": "Antanifotsy",
            "gps": [-19.65, 47.31667]
        }, {
            "name": "Ambilobe",
            "gps": [-13.2, 49.05]
        }]
    }, {
        "name": "Malawi",
        "iso3": "MWI",
        "city": [{
            "name": "Lilongwe",
            "gps": [-13.96692, 33.78725]
        }, {
            "name": "Mzuzu",
            "gps": [-11.46556, 34.02071]
        }, {
            "name": "Blantyre",
            "gps": [-15.78499, 35.00854]
        }, {
            "name": "Zomba",
            "gps": [-15.38596, 35.3188]
        }, {
            "name": "Mangochi",
            "gps": [-14.47815, 35.26448]
        }, {
            "name": "Kasungu",
            "gps": [-13.03333, 33.48333]
        }, {
            "name": "Karonga",
            "gps": [-9.93333, 33.93333]
        }, {
            "name": "Salima",
            "gps": [-13.7804, 34.4587]
        }, {
            "name": "Nkhotakota",
            "gps": [-12.92744, 34.29614]
        }, {
            "name": "Liwonde",
            "gps": [-15.06665, 35.22543]
        }]
    }, {
        "name": "Mali",
        "iso3": "MLI",
        "city": [{
            "name": "Bamako",
            "gps": [12.65, -8.0]
        }, {
            "name": "Sikasso",
            "gps": [11.31755, -5.66654]
        }, {
            "name": "Mopti",
            "gps": [14.4843, -4.18296]
        }, {
            "name": "Kayes",
            "gps": [14.44693, -11.44448]
        }, {
            "name": "Gao",
            "gps": [16.27167, -0.04472]
        }, {
            "name": "Ségou",
            "gps": [13.4317, -6.2157]
        }, {
            "name": "Koutiala",
            "gps": [12.39173, -5.46421]
        }, {
            "name": "Markala",
            "gps": [13.7021, -6.0659]
        }, {
            "name": "Timbuktu",
            "gps": [16.77348, -3.00742]
        }, {
            "name": "Kolokani",
            "gps": [13.5728, -8.0339]
        }]
    }, {
        "name": "Maroc",
        "iso3": "MAR",
        "city": [{
            "name": "Rabat",
            "gps": [34.01325, -6.83255]
        }, {
            "name": "Casablanca",
            "gps": [33.58831, -7.61138]
        }, {
            "name": "Marrakesh",
            "gps": [31.63416, -7.99994]
        }, {
            "name": "Agadir",
            "gps": [30.42018, -9.59815]
        }, {
            "name": "Fes",
            "gps": [34.03313, -5.00028]
        }, {
            "name": "Salé",
            "gps": [34.0531, -6.79846]
        }, {
            "name": "Tangier",
            "gps": [35.76727, -5.79975]
        }, {
            "name": "Laayoune",
            "gps": [27.1418, -13.18797]
        }, {
            "name": "Oujda",
            "gps": [34.68139, -1.90858]
        }, {
            "name": "Meknes",
            "gps": [33.89352, -5.54727]
        }]
    }, {
        "name": "Mauritanie",
        "iso3": "MRT",
        "city": [{
            "name": "Nouakchott",
            "gps": [18.08581, -15.9785]
        }, {
            "name": "Nouadhibou",
            "gps": [20.94188, -17.03842]
        }, {
            "name": "Kaédi",
            "gps": [16.15027, -13.5037]
        }, {
            "name": "Néma",
            "gps": [16.61702, -7.25649]
        }, {
            "name": "Zouérat",
            "gps": [22.73542, -12.47134]
        }, {
            "name": "Rosso",
            "gps": [16.51378, -15.80503]
        }, {
            "name": "Kiffa",
            "gps": [16.62073, -11.40208]
        }, {
            "name": "Atar",
            "gps": [20.5177, -13.04857]
        }, {
            "name": "Sélibaby",
            "gps": [15.15846, -12.1843]
        }, {
            "name": "Tékane",
            "gps": [16.57806, -15.45972]
        }]
    }, {
        "name": "Mozambique",
        "iso3": "MOZ",
        "city": [{
            "name": "Maputo",
            "gps": [-25.96553, 32.58322]
        }, {
            "name": "Nampula",
            "gps": [-15.11646, 39.2666]
        }, {
            "name": "Matola",
            "gps": [-25.96222, 32.45889]
        }, {
            "name": "Beira",
            "gps": [-19.84361, 34.83889]
        }, {
            "name": "Quelimane",
            "gps": [-17.87861, 36.88833]
        }, {
            "name": "Chimoio",
            "gps": [-19.11639, 33.48333]
        }, {
            "name": "Tete",
            "gps": [-16.15639, 33.58667]
        }, {
            "name": "Nacala",
            "gps": [-14.56257, 40.68538]
        }, {
            "name": "Xai-Xai",
            "gps": [-25.05194, 33.64417]
        }, {
            "name": "Maxixe",
            "gps": [-23.85972, 35.34722]
        }]
    }, {
        "name": "Namibie",
        "iso3": "NAM",
        "city": [{
            "name": "Windhoek",
            "gps": [-22.55941, 17.08323]
        }, {
            "name": "Rundu",
            "gps": [-17.93333, 19.76667]
        }, {
            "name": "Walvis Bay",
            "gps": [-22.9575, 14.50528]
        }, {
            "name": "Swakopmund",
            "gps": [-22.68333, 14.53333]
        }, {
            "name": "Oshakati",
            "gps": [-17.78333, 15.68333]
        }, {
            "name": "Katima Mulilo",
            "gps": [-17.5, 24.26667]
        }, {
            "name": "Grootfontein",
            "gps": [-19.56667, 18.11667]
        }, {
            "name": "Otjiwarongo",
            "gps": [-20.46369, 16.64772]
        }, {
            "name": "Rehoboth",
            "gps": [-23.317, 17.09]
        }, {
            "name": "Okahandja",
            "gps": [-21.98333, 16.91667]
        }]
    }, {
        "name": "Niger",
        "iso3": "NER",
        "city": [{
            "name": "Niamey",
            "gps": [13.51366, 2.1098]
        }, {
            "name": "Zinder",
            "gps": [13.80716, 8.9881]
        }, {
            "name": "Maradi",
            "gps": [13.5, 7.10174]
        }, {
            "name": "Agadez",
            "gps": [16.97333, 7.99111]
        }, {
            "name": "Tahoua",
            "gps": [14.8888, 5.2692]
        }, {
            "name": "Dosso",
            "gps": [13.049, 3.1937]
        }, {
            "name": "Alaghsas",
            "gps": [17.0187, 8.0168]
        }, {
            "name": "Birni N Konni",
            "gps": [13.79599, 5.25026]
        }, {
            "name": "Tessaoua",
            "gps": [13.75737, 7.9874]
        }, {
            "name": "Gaya",
            "gps": [11.88435, 3.44919]
        }]
    }, {
        "name": "Nigeria",
        "iso3": "NGA",
        "city": [{
            "name": "Ibadan",
            "gps": [7.37756, 3.90591]
        }, {
            "name": "Lagos",
            "gps": [6.45407, 3.39467]
        }, {
            "name": "Kano",
            "gps": [12.00012, 8.51672]
        }, {
            "name": "Kaduna",
            "gps": [10.52641, 7.43879]
        }, {
            "name": "Benin City",
            "gps": [6.33815, 5.62575]
        }, {
            "name": "Maiduguri",
            "gps": [11.84692, 13.15712]
        }, {
            "name": "Port Harcourt",
            "gps": [4.77742, 7.0134]
        }, {
            "name": "Abuja",
            "gps": [9.05785, 7.49508]
        }, {
            "name": "Jos",
            "gps": [9.92849, 8.89212]
        }, {
            "name": "Aba",
            "gps": [5.10658, 7.36667]
        }]
    }, {
        "name": "Ouganda",
        "iso3": "UGA",
        "city": [{
            "name": "Kampala",
            "gps": [0.31628, 32.58219]
        }, {
            "name": "Gulu",
            "gps": [2.77457, 32.29899]
        }, {
            "name": "Mbarara",
            "gps": [-0.60467, 30.64851]
        }, {
            "name": "Jinja",
            "gps": [0.43902, 33.20317]
        }, {
            "name": "Lira",
            "gps": [2.2499, 32.89985]
        }, {
            "name": "Bwizibwera",
            "gps": [-0.59167, 30.62861]
        }, {
            "name": "Mbale",
            "gps": [1.08209, 34.17503]
        }, {
            "name": "Masaka",
            "gps": [-0.33379, 31.73409]
        }, {
            "name": "Kasese",
            "gps": [0.18333, 30.08333]
        }, {
            "name": "Entebbe",
            "gps": [0.06444, 32.44694]
        }]
    }, {
        "name": "Rwanda",
        "iso3": "RWA",
        "city": [{
            "name": "Kigali",
            "gps": [-1.94995, 30.05885]
        }, {
            "name": "Butare",
            "gps": [-2.59667, 29.73944]
        }, {
            "name": "Gitarama",
            "gps": [-2.07444, 29.75667]
        }, {
            "name": "Ruhengeri",
            "gps": [-1.49984, 29.63497]
        }, {
            "name": "Gisenyi",
            "gps": [-1.70278, 29.25639]
        }, {
            "name": "Byumba",
            "gps": [-1.5763, 30.0675]
        }, {
            "name": "Rwamagana",
            "gps": [-1.9487, 30.4347]
        }, {
            "name": "Kibuye",
            "gps": [-2.06028, 29.34778]
        }, {
            "name": "Cyangugu",
            "gps": [-2.4846, 28.9075]
        }, {
            "name": "Kibungo",
            "gps": [-2.1597, 30.5427]
        }]
    }, {
        "name": "Sénégal",
        "iso3": "SEN",
        "city": [{
            "name": "Dakar",
            "gps": [14.6937, -17.44406]
        }, {
            "name": "Pikine",
            "gps": [14.76457, -17.39071]
        }, {
            "name": "Ziguinchor",
            "gps": [12.56801, -16.27326]
        }, {
            "name": "Touba",
            "gps": [14.85, -15.88333]
        }, {
            "name": "Saint-Louis",
            "gps": [16.01793, -16.48962]
        }, {
            "name": "Kaolack",
            "gps": [14.15197, -16.07259]
        }, {
            "name": "Tambacounda",
            "gps": [13.77073, -13.66734]
        }, {
            "name": "Thiès Nones",
            "gps": [14.78333, -16.96667]
        }, {
            "name": "Tiébo",
            "gps": [14.63333, -16.23333]
        }, {
            "name": "Mbaké",
            "gps": [14.79032, -15.90803]
        }]
    }, {
        "name": "Sierra Leone",
        "iso3": "SLE",
        "city": [{
            "name": "Freetown",
            "gps": [8.484, -13.22994]
        }, {
            "name": "Kenema",
            "gps": [7.87687, -11.19025]
        }, {
            "name": "Bo",
            "gps": [7.96472, -11.73833]
        }, {
            "name": "Makeni",
            "gps": [8.88605, -12.04417]
        }, {
            "name": "Koidu",
            "gps": [8.64387, -10.9714]
        }, {
            "name": "Port Loko",
            "gps": [8.76609, -12.78696]
        }, {
            "name": "Lunsar",
            "gps": [8.68439, -12.53499]
        }, {
            "name": "Waterloo",
            "gps": [8.3389, -13.07091]
        }, {
            "name": "Kabala",
            "gps": [9.58893, -11.55256]
        }, {
            "name": "Segbwema",
            "gps": [7.99471, -10.9502]
        }]
    }, {
        "name": "Somalie",
        "iso3": "SOM",
        "city": [{
            "name": "Mogadishu",
            "gps": [2.03711, 45.34375]
        }, {
            "name": "Hargeisa",
            "gps": [9.56, 44.065]
        }, {
            "name": "Berbera",
            "gps": [10.43959, 45.01432]
        }, {
            "name": "Baidoa",
            "gps": [3.11383, 43.6498]
        }, {
            "name": "Kismayo",
            "gps": [-0.35817, 42.54536]
        }, {
            "name": "Merca",
            "gps": [1.71594, 44.77166]
        }, {
            "name": "Burao",
            "gps": [9.52213, 45.53363]
        }, {
            "name": "Bosaso",
            "gps": [11.28421, 49.18158]
        }, {
            "name": "Jamaame",
            "gps": [0.06968, 42.74497]
        }, {
            "name": "Beledweyne",
            "gps": [4.73583, 45.20361]
        }]
    }, {
        "name": "Soudan",
        "iso3": "SDN",
        "city": [{
            "name": "Khartoum",
            "gps": [15.55177, 32.53241]
        }, {
            "name": "Omdurman",
            "gps": [15.64453, 32.47773]
        }, {
            "name": "Port Sudan",
            "gps": [19.61745, 37.21644]
        }, {
            "name": "Kassala",
            "gps": [15.45099, 36.39998]
        }, {
            "name": "Al-Ubayyid",
            "gps": [13.18421, 30.21669]
        }, {
            "name": "Gedaref",
            "gps": [14.03493, 35.38344]
        }, {
            "name": "Wad Madani",
            "gps": [14.40118, 33.51989]
        }, {
            "name": "Kūstī",
            "gps": [13.1629, 32.66347]
        }, {
            "name": "Ad Du'ayn",
            "gps": [11.46186, 26.12583]
        }, {
            "name": "Al-Fashir",
            "gps": [13.62793, 25.34936]
        }]
    }, {
        "name": "Soudan du Sud",
        "iso3": "SSD",
        "city": [{
            "name": "Juba",
            "gps": [4.85165, 31.58247]
        }, {
            "name": "Wau",
            "gps": [7.70111, 27.98972]
        }, {
            "name": "Malakal",
            "gps": [9.53342, 31.66049]
        }, {
            "name": "Yambio",
            "gps": [4.57083, 28.39417]
        }, {
            "name": "Pajok",
            "gps": [3.86512, 32.48212]
        }, {
            "name": "Yei",
            "gps": [4.09444, 30.67639]
        }, {
            "name": "Aweil",
            "gps": [8.76194, 27.39194]
        }, {
            "name": "Rumbek",
            "gps": [6.80619, 29.67742]
        }, {
            "name": "Bor",
            "gps": [6.20889, 31.55861]
        }, {
            "name": "Gogrial",
            "gps": [8.53324, 28.10037]
        }]
    }, {
        "name": "Swaziland",
        "iso3": "SWZ",
        "city": [{
            "name": "Mbabane",
            "gps": [-26.31667, 31.13333]
        }, {
            "name": "Manzini",
            "gps": [-26.49884, 31.38004]
        }, {
            "name": "Lobamba",
            "gps": [-26.46667, 31.2]
        }]
    }, {
        "name": "Tanzanie",
        "iso3": "TZA",
        "city": [{
            "name": "Dar es Salaam",
            "gps": [-6.82349, 39.26951]
        }, {
            "name": "Zanzibar",
            "gps": [-6.16394, 39.19793]
        }, {
            "name": "Mwanza",
            "gps": [-2.51667, 32.9]
        }, {
            "name": "Dodoma",
            "gps": [-6.17221, 35.73947]
        }, {
            "name": "Arusha",
            "gps": [-3.36667, 36.68333]
        }, {
            "name": "Tanga",
            "gps": [-5.06893, 39.09875]
        }, {
            "name": "Morogoro",
            "gps": [-6.82102, 37.66122]
        }, {
            "name": "Mbeya",
            "gps": [-8.9, 33.45]
        }, {
            "name": "Moshi",
            "gps": [-3.35, 37.33333]
        }, {
            "name": "Kigoma",
            "gps": [-4.87694, 29.62667]
        }]
    }, {
        "name": "Tchad",
        "iso3": "TCD",
        "city": [{
            "name": "N'Djamena",
            "gps": [12.10672, 15.0444]
        }, {
            "name": "Sarh",
            "gps": [9.1429, 18.3923]
        }, {
            "name": "Moundou",
            "gps": [8.56667, 16.08333]
        }, {
            "name": "Abéché",
            "gps": [13.82916, 20.8324]
        }, {
            "name": "Pala",
            "gps": [9.3642, 14.9046]
        }, {
            "name": "Koumra",
            "gps": [8.91256, 17.55392]
        }, {
            "name": "Kelo",
            "gps": [9.30859, 15.80658]
        }, {
            "name": "Am Timan",
            "gps": [11.0297, 20.2827]
        }, {
            "name": "Mongo",
            "gps": [12.18441, 18.69303]
        }, {
            "name": "Bongor",
            "gps": [10.28056, 15.37222]
        }]
    }, {
        "name": "Togo",
        "iso3": "TGO",
        "city": [{
            "name": "Lomé",
            "gps": [6.13748, 1.21227]
        }, {
            "name": "Sokodé",
            "gps": [8.98333, 1.13333]
        }, {
            "name": "Kara",
            "gps": [9.55111, 1.18611]
        }, {
            "name": "Atakpamé",
            "gps": [7.53333, 1.13333]
        }, {
            "name": "Palimé",
            "gps": [6.9, 0.63333]
        }, {
            "name": "Dapaong",
            "gps": [10.86225, 0.20762]
        }, {
            "name": "Bassar",
            "gps": [9.25025, 0.78213]
        }, {
            "name": "Tsévié",
            "gps": [6.42611, 1.21333]
        }, {
            "name": "Aného",
            "gps": [6.22798, 1.5919]
        }, {
            "name": "Sansanné-Mango",
            "gps": [10.35917, 0.47083]
        }]
    }, {
        "name": "Tunisie",
        "iso3": "TUN",
        "city": [{
            "name": "Tunis",
            "gps": [36.81897, 10.16579]
        }, {
            "name": "Sousse",
            "gps": [35.82539, 10.63699]
        }, {
            "name": "Sfax",
            "gps": [34.74056, 10.76028]
        }, {
            "name": "Kairouan",
            "gps": [35.6781, 10.09633]
        }, {
            "name": "Gabès",
            "gps": [33.88146, 10.0982]
        }, {
            "name": "Bizerte",
            "gps": [37.27442, 9.87391]
        }, {
            "name": "Gafsa",
            "gps": [34.425, 8.78417]
        }, {
            "name": "Midoun",
            "gps": [33.80813, 10.99228]
        }, {
            "name": "Aryanah",
            "gps": [36.86012, 10.19337]
        }, {
            "name": "Kasserine",
            "gps": [35.16758, 8.83651]
        }]
    }, {
        "name": "Zambie",
        "iso3": "ZMB",
        "city": [{
            "name": "Lusaka",
            "gps": [-15.40669, 28.28713]
        }, {
            "name": "Kitwe",
            "gps": [-12.80243, 28.21323]
        }, {
            "name": "Ndola",
            "gps": [-12.95867, 28.63659]
        }, {
            "name": "Kabwe",
            "gps": [-14.4469, 28.44644]
        }, {
            "name": "Mufulira",
            "gps": [-12.54982, 28.24071]
        }, {
            "name": "Luanshya",
            "gps": [-13.13667, 28.41661]
        }, {
            "name": "Kasama",
            "gps": [-10.21289, 31.18084]
        }, {
            "name": "Chingola",
            "gps": [-12.52897, 27.88382]
        }, {
            "name": "Livingstone",
            "gps": [-17.84194, 25.85425]
        }, {
            "name": "Chipata",
            "gps": [-13.63333, 32.65]
        }]
    }, {
        "name": "Zimbabwe",
        "iso3": "ZWE",
        "city": [{
            "name": "Harare",
            "gps": [-17.82772, 31.05337]
        }, {
            "name": "Bulawayo",
            "gps": [-20.15, 28.58333]
        }, {
            "name": "Gweru",
            "gps": [-19.45, 29.81667]
        }, {
            "name": "Mutare",
            "gps": [-18.9707, 32.67086]
        }, {
            "name": "Chitungwiza",
            "gps": [-18.01274, 31.07555]
        }, {
            "name": "Epworth",
            "gps": [-17.89, 31.1475]
        }, {
            "name": "Kadoma",
            "gps": [-18.33328, 29.91534]
        }, {
            "name": "Masvingo",
            "gps": [-20.06373, 30.82766]
        }, {
            "name": "Kwekwe",
            "gps": [-18.92809, 29.81486]
        }, {
            "name": "Chinhoyi",
            "gps": [-17.36667, 30.2]
        }]
    }]
};

mapboxgl.accessToken = 'pk.eyJ1IjoiZXRpYmR2IiwiYSI6ImNpejhvdWJmcjAwMW8yd28weTkzMnA1aDkifQ.i8UKq0M_sIN1qq8F6UAgFw';

// Chargement des paramètres en lisant le hash, paramètres par défaut sinon
var params = location.hash;

function parseP(params) {
    var list_params = params.split("?");
    dict_params = {}
    list_params.forEach(function(pair) {
        var temp = pair.split("=");
        if (temp.length == 2) {
            dict_params[temp[0]] = temp[1]
        }
    })
    return dict_params

}



// ====================  MAP ===================================
function create_featurelayer(iconUrl, color, kind, identity) {

    /*

    "json/"+identity+"-"+kind+"-center.geojson"
    */



    $.getJSON("data/urban/" + identity + "-" + kind + "-center.geojson", function(data) {
        data.features.forEach(function(marker) {
            var keys = Object.keys(marker.properties);
            var kind1 = ["amenity", "leisure"];
            var kind2 = ["university", "marketplace", "townhall", "hospital"];
            var kind3 = ["pitch"]

            if (marker.properties["amenity"]) {
                if (kind2.includes(marker.properties["amenity"])) {
                    var el = document.createElement('div');
                    el.classList.add('marker', kind);
                    el.style.backgroundImage = "url('" + iconUrl + "')"

                    if (dict_P[kind] == "f") {
                        el.style.visibility = "hidden";
                    }

                    var text = '';

                    keys.map(function(key) {
                        text = text + '<b>' + key + "</b> : " + marker.properties[key] + "<br>"
                    });


                    var popup = new mapboxgl.Popup({
                            offset: 25
                        })
                        .setHTML(text);

                    new mapboxgl.Marker(el, {
                            offset: [-50 / 2, -50 / 2]
                        })
                        .setLngLat(turf.center(marker).geometry.coordinates)
                        .setPopup(popup)
                        .addTo(mapm);





                }


            } else if (marker.properties["leisure"]) {
                if (kind3.includes(marker.properties["leisure"])) {



                    var el = document.createElement('div');
                    el.classList.add('marker', kind);
                    el.style.backgroundImage = "url('" + iconUrl + "')"
                    if ("stadium" in dict_P) {
                        if (dict_P[kind] == "f") {
                            el.style.visibility = "hidden";
                        }
                    } else {
                        el.style.visibility = "hidden";
                    }

                    var text = '';

                    keys.map(function(key) {
                        text = text + '<b>' + key + "</b> : " + marker.properties[key] + "<br>"
                    });

                    var popup = new mapboxgl.Popup({
                            offset: 25
                        })
                        .setHTML(text);





                    new mapboxgl.Marker(el, {
                            offset: [-50 / 2, -50 / 2]
                        })
                        .setLngLat(turf.center(marker).geometry.coordinates)
                        .setPopup(popup)
                        .addTo(mapm);





                }




            }




        })

    });




}

function onEachFeature(feature, layer) {
    // When one click on an item, it returns more information about the objecthttps://extranet.afd.fr/owa/,DanaInfo=.aenclpEgmlIp2,SSL+
    var popupContent = "Type: " + feature.properties.amenity + "</br> Name: " +
        feature.properties.name;

    if (feature.properties && feature.properties.popupContent) {
        popupContent += feature.properties.popupContent;
    }

    layer.bindPopup(popupContent);

};




//========== MAPBOX GL ==================
function setLayers() {

    if (feat) {
        draw.add(feat)
    }

    if ("dlr" in dict_P) {
        var dlr = dict_P["dlr"]
        sliderValuechi.textContent = dlr + '%';
        sliderchi.value = parseInt(dlr, 10);
    } else {
        var dlr = 0
    }
    if ("worldpop" in dict_P) {
        var wo = dict_P["worldpop"]
        sliderValuedal.textContent = wo + '%';
        sliderdal.value = parseInt(wo, 10);
    } else {
        var wo = 0
    }




    if (mapm.getLayer("chicago")) {
        sliderchi.addEventListener('input', function(e) {
            mapm.setPaintProperty('chicago', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            sliderValuechi.textContent = e.target.value + '%';

        })
    } else {
        mapm.addLayer({
            'id': 'chicago',
            'type': 'raster',
            'source': {
                'type': 'raster',
                'tiles': [
                    'http://geoservice.dlr.de/eoc/land/ows?bbox={bbox-epsg-3857}&format=image/png&service=WMS&request=GetMap&srs=EPSG:3857&width=256&height=256&layers=GUF28_DLR_v1_Mosaic'
                ],
                'tileSize': 256
            },
            'paint': {
                'raster-opacity': parseInt(dlr, 10) / 100
            }
        }, 'chicago');
        sliderchi.addEventListener('input', function(e) {
            mapm.setPaintProperty('chicago', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            sliderValuechi.textContent = e.target.value + '%';

        })
    }


    if (mapm.getLayer("dallas")) {

        sliderdal.addEventListener('input', function(e) {
            mapm.setPaintProperty('dallas', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            sliderValuedal.textContent = e.target.value + '%';
        })

    } else {

        mapm.addLayer({
            'id': 'dallas',
            'type': 'raster',
            'source': {
                'type': 'raster',
                'tiles': [
                    'https://api.mapbox.com/styles/v1/etibdv/cj1f6c58g00iu2smfbwp8yslt/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXRpYmR2IiwiYSI6ImNpejhvdWJmcjAwMW8yd28weTkzMnA1aDkifQ.i8UKq0M_sIN1qq8F6UAgFw'
                ],
                'tileSize': 256
            },
            'paint': {
                'raster-opacity': parseInt(wo, 10) / 100

            }
        }, 'dallas');
        sliderdal.addEventListener('input', function(e) {
            mapm.setPaintProperty('dallas', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            sliderValuedal.textContent = e.target.value + '%';
        })



    }
}

function setMapbox(identity) {
    //icons

    create_featurelayer("css/urban/icons/hospitalicon.png", "#f00000", "hospital", identity)
    create_featurelayer("css/urban/icons/uniicon.png", "#12a81c", "uni", identity)
    create_featurelayer("css/urban/icons/marketicon.png", "#e9e223", "marketplace", identity)
    create_featurelayer("css/urban//icons/townhallicon.png", "#0000ff", "townhall", identity)
    create_featurelayer("css/urban//icons/busstationicon.png", "#333333", "bus", identity)
    create_featurelayer("css/urban/icons/stadium.png", "#333333", "stadium", identity)






    //roads


    mapm.on('load', function() {
        setLayers()
        $.getJSON("data/urban/" + identity + "-road-center.geojson", function(data) {

            gjson = data;
            mapm.addSource('some id', {
                type: 'geojson',
                data: gjson,
            });

            mapm.addLayer({
                "id": "route",
                "type": "line",
                "source": "some id",
                "paint": {
                    "line-color": "#888",
                    "line-width": 10,
                    "line-opacity": 0,
                },
            })
        });





    });






}


function loadmethod() {

    $.getJSON("data/urban/methods.json", function(method) {

        var source = document.getElementById('source');

        switch (method[data.country[cnt].iso3][1]) {
            case "classic":
                var getmethod = "Approche basée sur les census et l'occupation des sols <a href='http://www.worldpop.org.uk/data/methods/'>Plus d'informations</a>"
                break;
            case "pop":
                var getmethod = "Approche basée sur les census et le Random Forest <a href='http://www.worldpop.org.uk/data/methods/'>Plus d'informations</a>"
                break;
            case "random":
                var getmethod = "Approche basée sur les census et les données Fondation Gates <a href='http://www.worldpop.org.uk/data/methods/'>Plus d'informations</a>"
        }


        source.innerHTML = "<p>Année: " + method[data.country[cnt].iso3][0] + "</p><p>Méthode: " + getmethod + "</p>"
    })


}


function onChangeCountry() {
    loadmethod()

    //Changer liste de ville
    cnt = $('select[name=country]').val();
    var sel = $("select[name=city]").empty();
    $(data.country[cnt].city).each(function(index) {
        sel.append($("<option>").attr('value', index).text(this.name));
    });

    sel.selectpicker('refresh')
    ind = 0
        //mettre à jour les liens
    $("#countrydash").attr("href", "http://afd.countrydashboards.com/Country_dashboard" + data.country[cnt].iso3 + ".html")


    //changer vue de la carte
    onChangeCity()


}

function onChangeCity() {
    ind = $("select[name=city]").val();
    draw.deleteAll()
    mapm.setCenter([data.country[cnt].city[ind].gps[1], data.country[cnt].city[ind].gps[0]])
    var answer = document.getElementById('calculated-area');
    answer.innerHTML = "";
    setMapbox(data.country[cnt].city[ind].name);
}





//============= ANALYTICS FUNCTION================






function rotatePoints(center, points, yaw, r) {
    var res = []
    var angle = yaw * (Math.PI / 180)

    for (var i = 0; i < points.length; i++) {
        var p = points[i]
            // translate to center
        var p2 = [p[0] - center[0], p[1] - center[1]]
            // rotate using matrix rotation
        var p3 = [Math.cos(angle) * p2[0] - Math.sin(angle) * p2[1], Math.sin(angle) * p2[0] + Math.cos(angle) * p2[1]]
            // translate back to cente

        t = turf.distanceToDegrees(r)

        var d = Math.sqrt(Math.pow(p3[0], 2) + Math.pow(p3[1], 2))

        var alpha = t / d


        var p4 = [alpha * p3[0] + center[0], alpha * p3[1] + center[1]]
            // done with that point
        res.push(p4)
    }
    return res
}

function line2rect(point1, point2, r) {
    res = []

    res.push(rotatePoints(point1, [point2], 90, r))
    res.push(rotatePoints(point1, [point2], -90, r))

    var u = point2[0] - point1[0]
    var v = point2[1] - point1[1]


    var tur = res.map(function(x) {
        return turf.point(x[0])
    });
    res.map(function(x) {
        tur.push(turf.point([x[0][0] + u, x[0][1] + v]))
    })

    return tur

}




//============== EXPORT =======================
var exportgjson = document.getElementById('export_geojson');

exportgjson.onclick = function() {
    var data_gjson = draw.getAll();

    if (data_gjson) {
        var text = "text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data_gjson));
        $('#export_geojson').attr("href", 'data:attachment/' + text);
        $('#export_geojson').attr("target", '_blank');
        $('#export_geojson').attr("download", data.country[cnt].city[ind].name + '_geodata.geojson');


        var text = [
            ["Country Name ", data.country[cnt].name],
            ["City Name", data.country[cnt].city[ind].name],
            ["Inhabitants", hab, "people"],
            ["Area", rounded_area, "km2"],
            ["Length Primary Network", size_road, "km"]
        ];
        var csvContent = "data:text/csv;charset=utf-8,";
        text.forEach(function(infoArray, index) {

            dataString = infoArray.join(",");

            csvContent += dataString + "\n";

        });

        var hiddenElement = document.createElement('a');

        hiddenElement.href = encodeURI(csvContent);
        hiddenElement.target = '_blank';
        hiddenElement.download = data.country[cnt].city[ind].name + '_indicator.csv'
        hiddenElement.click();


    } else {
        alert("Vous devez dessiner pour exporter")
    }

}




function test(id) {

    if (document.getElementById(id).checked == true) {
        var elems = document.getElementsByClassName(id);
        dict_P[id] = "t";
        for (i = 0; i < elems.length; i++) {
            elems[i].style.visibility = "visible";
        }



    } else {

        var elems = document.getElementsByClassName(id);
        dict_P[id] = "f";
        for (i = 0; i < elems.length; i++) {
            elems[i].style.visibility = "hidden";
        }

    };

};


function changestyle(id) {
    mapm.setStyle(id);
    mapm.on('style.load', function() {
        setLayers();
    });


    dict_P["style"] = id;

}
var dpi = 300;
Object.defineProperty(window, 'devicePixelRatio', {
    get: function() {
        return dpi / 96
    }
});

function exportmap() {
    var content = mapm.getCanvas();
    content.toBlob(function(blob) {
        saveAs(blob, "screenshot.png");
    }, "image/png");
};


function sharemap() {
    // récupération des paramètres des bases
    params_dict = {}

    params_dict["country"] = data.country[cnt].iso3;
    params_dict["city"] = ind;
    params_dict["style"] = dict_P["style"];


    var lnglat = mapm.getCenter();

    params_dict["lon"] = lnglat["lng"].toString()
    params_dict["lat"] = lnglat["lat"].toString()

    params_dict["z"] = mapm.getZoom();
    //Recuperation etat des boutons
    liste_id.forEach(function(id) {
        if (document.getElementById(id).checked == false) {
            params_dict[id] = "f";
        } else {
            params_dict[id] = "t";
        }

    })



    //Recuperation transparence
    params_dict["dlr"] = sliderchi.value.toString()
    params_dict["worldpop"] = sliderdal.value.toString()

    //Recuperation choix utilisateur

    liste_choix = ["menu", "control", "tools"]
    liste_choix.forEach(function(id) {
        if (document.getElementById(id).checked == false) {
            params_dict[id] = "f";
        }

    });

    if (document.getElementById("polygons").checked == true) {
        var data_g = draw.getAll();
        var text = encodeURIComponent(JSON.stringify(data_g));
        params_dict["polygons"] = text;

    };

    var link = dict2link(params_dict)
    var content = document.getElementById("clipboard")
    content.value = link;



}

function dict2link(dictionnary) {
    var link = "beta.dataspace.fr/city/#"
    for (var key in dictionnary) {
        var text = '?' + key + "=" + dictionnary[key];
        link = link + text
    }
    return link

}
var calcButton = document.getElementById('calculate');


calcButton.onclick = function() {

    var data = draw.getAll();
    var arrayIntersection = [];
    //===== GET  LENGTH OF ROADS
    gjson.features.map(function(x) {
        if (x.type == "Feature") {
            var xpoints = turf.explode(x);
            var ptsWithin = turf.within(xpoints, data);
            var point1 = xpoints.features[0];
            var point2 = xpoints.features[xpoints.features.length - 1];
            if (ptsWithin.features.length == xpoints.features.length) {
                arrayIntersection.push(x)
            } else if ((ptsWithin.features.length < xpoints.features.length) && (ptsWithin.features.length > 0)) {
                var temp = turf.featureCollection([point1, point2]);
                var get = turf.within(temp, data);
                var points = turf.lineIntersect(x, data.features[0]);
                var result = []
                points.features.map(function(x) {
                    result.push(x)
                });
                get.features.map(function(x) {
                    result.push(x)
                });
                result = turf.featureCollection(result);

                if (result.features.length == 2) {

                    var sliced = turf.lineSlice(result.features[0], result.features[1], x);

                    arrayIntersection.push(sliced)
                }
            }
        }

    });

    //======= GET  SIZE OF ROAD ================

    size_road = 0;
    arrayIntersection.map(function(x) {
        if (x.geometry.type != "Point") {
            size_road += turf.lineDistance(x, 'kilometers');
        }
    })
    JSONIntersection = turf.featureCollection(arrayIntersection);

    //==== GET DENSITY OF GRID =======
    var bbox = turf.bbox(data);

    var n = 1000;
    var dist = Math.sqrt(((bbox[2] - bbox[0]) * (bbox[3] - bbox[1])) / n);

    var grid = turf.pointGrid(bbox, dist, 'degrees');
    var isInside = turf.within(grid, data);

    var density = 0;

    isInside.features.map(function(x) {
        var temp = mapm.queryRenderedFeatures(mapm.project(x.geometry.coordinates));
        temp.map(function(y) {
                if (y.properties.densitypph) {
                    density += y.properties.densitypph
                }
            })
            //========AND COMPUTE RESULT ===================

    });
    if (data.features.length > 0) {
        var area = turf.area(data);
        // restrict to area to 2 decimal points
        rounded_area = Math.round(area * 0.00001) / 10;
        var rounded_kil = Math.round(size_road * 10) / 10;
        hab = Math.round(((density * rounded_area * 100) / isInside.features.length) / 1000) * 1000;
        var min_hab = Math.round(hab * 0.9);
        var max_hab = Math.round(hab * 1.1);
        var min_kilhab = Math.round(min_hab / size_road);
        var max_kilhab = Math.round(max_hab / size_road);
        var answer = document.getElementById('surface_table');
        answer.innerHTML = rounded_area;

        var answer = document.getElementById('population_table');
        answer.innerHTML =  min_hab + '-' + max_hab;

       
        var answer = document.getElementById('primary_road');
        answer.innerHTML =  rounded_kil;

        var answer = document.getElementById('ratio');
        answer.innerHTML =  min_kilhab + '-' + max_kilhab;
         
    } else {
        alert("Utilisez les outils en haut à gauche pour dessiner un polygone!");
    }
    document.getElementById('export_geojson').style.visibility = 'visible';

};

var corridorButton = document.getElementById('corridor');

corridorButton.onclick = function() {
    var r = document.getElementById('corridor-text').value
    var data = draw.getAll();
    var newdraw
    var linelength = 0;


    data.features.map(function(feature) {
        switch (feature.geometry.type) {
            case "LineString":
                var buff = []
                feature.geometry.coordinates.map(function(x) {
                    buff.push(x)
                })
                var temp = turf.circle(buff[0], r / 1000, 10, 'kilometers')
                linelength = linelength + turf.lineDistance(feature.geometry);
                for (var i = 0; i < buff.length - 1; i++) {
                    var retour = line2rect(buff[i], buff[i + 1], r / 1000)

                    a = turf.convex(turf.featureCollection(retour))
                    b = turf.circle(buff[i], r / 1000, 10, 'kilometers')
                    c = turf.circle(buff[i + 1], r / 1000, 10, 'kilometers')
                    temp = turf.union(temp, a, b, c)
                }
                if (newdraw) {
                    newdraw = turf.union(newdraw, temp)
                } else {
                    newdraw = temp
                }
                break;
            case "Point":
                var temp = turf.circle(feature.geometry.coordinates, r / 1000, 100, 'kilometers');


                if (newdraw) {
                    newdraw = turf.union(newdraw, temp)
                } else {
                    newdraw = temp
                }

                break;
            default:
                break;
        }

    });
    var answer = document.getElementById("corridor_length");
    console.log(answer)
    answer.innerHTML = Math.round(linelength * 10) / 10;
    draw.deleteAll()


    draw.add(newdraw)


}



// Initialisation 








var dict_P = parseP(params)

if ("menu" in dict_P) {
    if (dict_P["menu"] == "f") {
        var afd = document.getElementById('afd');
        var block = document.getElementById('blocko');
        afd.style.height = "0px";
        afd.style.visibility = "hidden";
        blocko.style.height = "100%";


    }
}

if ("tools" in dict_P) {
    if (dict_P["tools"] == "f") {
        var info = document.getElementById('info');
        info.style.visibility = "hidden";
        info.style.width = "0px";


    }
}
var liste_id = ["marketplace", "uni", "townhall", "hospital", "stadium"];

// Set POIs

liste_id.forEach(function(id) {
    if (id in dict_P) {
        if (dict_P[id] == "f") {

        }
    }
})
if ("marketplace" in dict_P) {
    if (dict_P["marketplace"] == "f") {
        document.getElementById("marketplace").checked = false;

    }
};
if ("uni" in dict_P) {
    if (dict_P["uni"] == "f") {
        document.getElementById("uni").checked = false;


    }
};
if ("townhall" in dict_P) {
    if (dict_P["townhall"] == "f") {
        document.getElementById("townhall").checked = false;


    }
};
if ("hospital" in dict_P) {
    if (dict_P["hospital"] == "f") {
        document.getElementById("hospital").checked = false;


    }
};

if ("stadium" in dict_P) {
    if (dict_P["stadium"] == "f") {
        document.getElementById("stadium").checked = false;

    } else {
        document.getElementById("stadium").checked = true;

    }
} else {
    document.getElementById("stadium").checked = false;

};


//Creation of the maps
var mapm = new mapboxgl.Map({
    container: 'mapid1',
    preserveDrawingBuffer: true,
});
if ("style" in dict_P) {
    mapm.setStyle(dict_P["style"])
} else {
    mapm.setStyle("mapbox://styles/etibdv/cj0cviykv00br2sqpvtoco9j8");
    dict_P["style"] = "mapbox://styles/etibdv/cj0cviykv00br2sqpvtoco9j8";
}


if ("control" in dict_P) {
    if (dict_P["control"] == "f") {
        //==========CONTROL ===============
        draw = new MapboxDraw({
            displayControlsDefault: false,
            controls: {
                polygon: false,
                line_string: false,
                trash: false,
                point: false,
            }
        });
        mapm.addControl(draw, 'top-left');
        mapm.addControl(new mapboxgl.ScaleControl({
            maxWidth: 300,
        }));
        var filter = document.getElementById('filter-group');
        filter.style.height = "0px";
        filter.style.visibility = "hidden";

        if ("polygons" in dict_P) {
            var polygons = dict_P["polygons"];
            feat = JSON.parse(decodeURIComponent(polygons));

        }




    }
} else {
    //==========CONTROL ===============
    draw = new MapboxDraw({
        displayControlsDefault: false,
        controls: {
            polygon: true,
            line_string: true,
            trash: true,
            point: true,
        }
    });
    mapm.addControl(draw, 'top-left');
    mapm.addControl(new mapboxgl.ScaleControl({
        maxWidth: 300,
    }));

    if ("polygons" in dict_P) {
        var polygons = dict_P["polygons"];
        var feat = JSON.parse(decodeURIComponent(polygons));


    }


}



var controlleur


//====== INIT=======

// Chargement pays 
if ("country" in dict_P) {
    var iso3 = dict_P["country"];
} else {
    var iso3 = undefined
};


var cnt = 0
var sel = '<select name="country" class="selectpicker" onchange="onChangeCountry()">';
$(data.country).each(function(index) {
    if (data.country[index].iso3 == iso3) {
        sel += "<option value=" + index + " selected>" + this.name + "</option>";
        cnt = index;
    } else {
        sel += "<option value=" + index + ">" + this.name + "</option>";
    };
});
sel += '</select>'
$(sel).appendTo('#info_select');





//Chargement ville
if ("city" in dict_P) {
    var city = dict_P["city"];
} else {
    var city = undefined
};
var ind = 0
var sel1 = '<select name="city" class="selectpicker" onchange="onChangeCity()">';
$(data.country[cnt].city).each(function(index) {
    if (index == city) {
        sel1 += "<option value=" + index + " selected>" + this.name + "</option>";
        ind = city;
    } else {
        sel1 += "<option value=" + index + ">" + this.name + "</option>";
    }
});
sel1 += '</select>'
$(sel1).appendTo('#info_select');



// Chargement coordonnées
if ("lon" in dict_P) {
    var lon = dict_P["lon"];
} else {
    var lon = data.country[cnt].city[ind].gps[1];
};

if ("lat" in dict_P) {
    var lat = dict_P["lat"];
} else {
    var lat = data.country[cnt].city[ind].gps[0];
};

if ("z" in dict_P) {
    var zoom = dict_P["z"];
} else {
    var zoom = 13;
};


mapm.setZoom(zoom)
mapm.setCenter([lon, lat])


setMapbox(data.country[cnt].city[ind].name)




$("#countrydash").attr("href", "http://afd.countrydashboards.com/Country_dashboard" + data.country[cnt].iso3 + ".html")
loadmethod()



var sliderchi = document.getElementById('slider-chicago');
var sliderValuechi = document.getElementById('slider-value-chicago');

var sliderdal = document.getElementById('slider-dallas');
var sliderValuedal = document.getElementById('slider-value-dallas');